/**
 *
 * carbon-angular v0.0.0 | modal.service.js
 *
 * Copyright 2014, 2022 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { ComponentFactoryResolver, Injector } from "@angular/core";
import { Injectable } from "@angular/core";
import { AlertModal } from "./alert-modal.component";
import { PlaceholderService } from "carbon-components-angular/placeholder";
import { tap, delay } from "rxjs/operators";
/**
 * Modal service handles instantiating and destroying modal instances.
 * Uses PlaceholderService to track open instances, and for it's placeholder view reference.
 */
export class ModalService {
    /**
     * Creates an instance of `ModalService`.
     */
    constructor(resolver, placeholderService) {
        this.resolver = resolver;
        this.placeholderService = placeholderService;
    }
    /**
     * Creates and renders the modal component that is passed in.
     * `inputs` is an optional parameter of `data` that can be passed to the `Modal` component.
     */
    create(data) {
        let defaults = { inputs: {} };
        data = Object.assign({}, defaults, data);
        const inputProviders = Object.keys(data.inputs).map(inputName => ({
            provide: inputName,
            useValue: data.inputs[inputName]
        }));
        const injector = Injector.create(inputProviders);
        const factory = this.resolver.resolveComponentFactory(data.component);
        let focusedElement = document.activeElement;
        let component = this.placeholderService.createComponent(factory, injector);
        setTimeout(() => {
            component.instance.open = true;
        });
        component["previouslyFocusedElement"] = focusedElement; // used to return focus to previously focused element
        component.instance.close.pipe(
        // trigger the close animation
        tap(() => {
            component.instance.open = false;
        }), 
        // delay closing by an arbitrary amount to allow the animation to finish
        delay(150)).subscribe(() => {
            this.placeholderService.destroyComponent(component);
            // filter out our component
            ModalService.modalList = ModalService.modalList.filter(c => c !== component);
        });
        component.onDestroy(() => {
            focusedElement.focus();
        });
        ModalService.modalList.push(component);
        return component;
    }
    /**
     * Creates and renders a new alert modal component.
     * @param data You can pass in:
     * `type` - "default" | "danger" = "default",
     * `label` - a label shown over the title,
     * `title` - modal's title,
     * `content` - modal's content, could include HTML tags.
     * `buttons` is an array of objects
     * `close` custom close function
     * ```
     * {
     * 		text: "Button text",
     * 		type: "primary" | "secondary" | "tertiary" | "ghost" | "danger" | "danger--primary" = "primary",
     * 		click: clickFunction,
     * }
     * ```
     */
    show(data) {
        return this.create({
            component: AlertModal,
            inputs: {
                type: data.type,
                label: data.label,
                title: data.title,
                content: data.content,
                hasScrollingContent: data.hasScrollingContent || null,
                size: data.size,
                buttons: data.buttons || [],
                close: data.close || (() => { }),
                showCloseButton: data.showCloseButton
            }
        });
    }
    /**
     * Destroys the modal on the supplied index.
     * When called without parameters it destroys the most recently created/top most modal.
     */
    destroy(index = -1) {
        // return if nothing to destroy because it's already destroyed
        if (index >= ModalService.modalList.length || ModalService.modalList.length === 0) {
            return;
        }
        // on negative index destroy the last on the list (top modal)
        if (index < 0) {
            index = ModalService.modalList.length - 1;
        }
        this.placeholderService.destroyComponent(ModalService.modalList[index]);
        ModalService.modalList.splice(index, 1);
    }
}
// track all our open modals
ModalService.modalList = [];
ModalService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
ModalService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: PlaceholderService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvbW9kYWwvIiwic291cmNlcyI6WyJtb2RhbC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTix3QkFBd0IsRUFFeEIsUUFBUSxFQUNSLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRXJELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFHNUM7OztHQUdHO0FBRUgsTUFBTSxPQUFPLFlBQVk7SUFJeEI7O09BRUc7SUFDSCxZQUFtQixRQUFrQyxFQUFTLGtCQUFzQztRQUFqRixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUFTLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7SUFBRyxDQUFDO0lBRXhHOzs7T0FHRztJQUNILE1BQU0sQ0FBSSxJQUFvQztRQUM3QyxJQUFJLFFBQVEsR0FBRyxFQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUMsQ0FBQztRQUM1QixJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRXpDLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDakUsT0FBTyxFQUFFLFNBQVM7WUFDbEIsUUFBUSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO1NBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBQ0osTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLE1B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LE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQzs7QUF4R0QsNEJBQTRCO0FBQ1gsc0JBQVMsR0FBNkIsRUFBRSxDQUFDOztZQUgxRCxVQUFVOzs7O1lBakJWLHdCQUF3QjtZQVNoQixrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG5cdENvbXBvbmVudFJlZixcblx0SW5qZWN0b3Jcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE1vZGFsIH0gZnJvbSBcIi4vbW9kYWwuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBSZXBsYXlTdWJqZWN0IH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgQWxlcnRNb2RhbCB9IGZyb20gXCIuL2FsZXJ0LW1vZGFsLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgQWxlcnRNb2RhbERhdGEgfSBmcm9tIFwiLi9hbGVydC1tb2RhbC5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IFBsYWNlaG9sZGVyU2VydmljZSB9IGZyb20gXCJjYXJib24tY29tcG9uZW50cy1hbmd1bGFyL3BsYWNlaG9sZGVyXCI7XG5pbXBvcnQgeyB0YXAsIGRlbGF5IH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5cblxuLyoqXG4gKiBNb2RhbCBzZXJ2aWNlIGhhbmRsZXMgaW5zdGFudGlhdGluZyBhbmQgZGVzdHJveWluZyBtb2RhbCBpbnN0YW5jZXMuXG4gKiBVc2VzIFBsYWNlaG9sZGVyU2VydmljZSB0byB0cmFjayBvcGVuIGluc3RhbmNlcywgYW5kIGZvciBpdCdzIHBsYWNlaG9sZGVyIHZpZXcgcmVmZXJlbmNlLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTW9kYWxTZXJ2aWNlIHtcblx0Ly8gdHJhY2sgYWxsIG91ciBvcGVuIG1vZGFsc1xuXHRwcm90ZWN0ZWQgc3RhdGljIG1vZGFsTGlzdDogQXJyYXk8Q29tcG9uZW50UmVmPGFueT4+ID0gW107XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYE1vZGFsU2VydmljZWAuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihwdWJsaWMgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgcHVibGljIHBsYWNlaG9sZGVyU2VydmljZTogUGxhY2Vob2xkZXJTZXJ2aWNlKSB7fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuZCByZW5kZXJzIHRoZSBtb2RhbCBjb21wb25lbnQgdGhhdCBpcyBwYXNzZWQgaW4uXG5cdCAqIGBpbnB1dHNgIGlzIGFuIG9wdGlvbmFsIHBhcmFtZXRlciBvZiBgZGF0YWAgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIHRoZSBgTW9kYWxgIGNvbXBvbmVudC5cblx0ICovXG5cdGNyZWF0ZTxUPihkYXRhOiB7Y29tcG9uZW50OiBhbnksIGlucHV0cz86IGFueX0pOiBDb21wb25lbnRSZWY8YW55PiB7XG5cdFx0bGV0IGRlZmF1bHRzID0ge2lucHV0czoge319O1xuXHRcdGRhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgZGF0YSk7XG5cblx0XHRjb25zdCBpbnB1dFByb3ZpZGVycyA9IE9iamVjdC5rZXlzKGRhdGEuaW5wdXRzKS5tYXAoaW5wdXROYW1lID0+ICh7XG5cdFx0XHRwcm92aWRlOiBpbnB1dE5hbWUsXG5cdFx0XHR1c2VWYWx1ZTogZGF0YS5pbnB1dHNbaW5wdXROYW1lXVxuXHRcdH0pKTtcblx0XHRjb25zdCBpbmplY3RvciA9IEluamVjdG9yLmNyZWF0ZShpbnB1dFByb3ZpZGVycyk7XG5cdFx0Y29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoZGF0YS5jb21wb25lbnQpO1xuXHRcdGxldCBmb2N1c2VkRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG5cblx0XHRsZXQgY29tcG9uZW50ID0gdGhpcy5wbGFjZWhvbGRlclNlcnZpY2UuY3JlYXRlQ29tcG9uZW50KGZhY3RvcnksIGluamVjdG9yKTtcblxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0Y29tcG9uZW50Lmluc3RhbmNlLm9wZW4gPSB0cnVlO1xuXHRcdH0pO1xuXG5cdFx0Y29tcG9uZW50W1wicHJldmlvdXNseUZvY3VzZWRFbGVtZW50XCJdID0gZm9jdXNlZEVsZW1lbnQ7ICAvLyB1c2VkIHRvIHJldHVybiBmb2N1cyB0byBwcmV2aW91c2x5IGZvY3VzZWQgZWxlbWVudFxuXG5cdFx0Y29tcG9uZW50Lmluc3RhbmNlLmNsb3NlLnBpcGUoXG5cdFx0XHQvLyB0cmlnZ2VyIHRoZSBjbG9zZSBhbmltYXRpb25cblx0XHRcdHRhcCgoKSA9PiB7XG5cdFx0XHRcdGNvbXBvbmVudC5pbnN0YW5jZS5vcGVuID0gZmFsc2U7XG5cdFx0XHR9KSxcblx0XHRcdC8vIGRlbGF5IGNsb3NpbmcgYnkgYW4gYXJiaXRyYXJ5IGFtb3VudCB0byBhbGxvdyB0aGUgYW5pbWF0aW9uIHRvIGZpbmlzaFxuXHRcdFx0ZGVsYXkoMTUwKVxuXHRcdCkuc3Vic2NyaWJlKCgpID0+IHtcblx0XHRcdHRoaXMucGxhY2Vob2xkZXJTZXJ2aWNlLmRlc3Ryb3lDb21wb25lbnQoY29tcG9uZW50KTtcblx0XHRcdC8vIGZpbHRlciBvdXQgb3VyIGNvbXBvbmVudFxuXHRcdFx0TW9kYWxTZXJ2aWNlLm1vZGFsTGlzdCA9IE1vZGFsU2VydmljZS5tb2RhbExpc3QuZmlsdGVyKGMgPT4gYyAhPT0gY29tcG9uZW50KTtcblx0XHR9KTtcblxuXHRcdGNvbXBvbmVudC5vbkRlc3Ryb3koKCkgPT4ge1xuXHRcdFx0Zm9jdXNlZEVsZW1lbnQuZm9jdXMoKTtcblx0XHR9KTtcblxuXHRcdE1vZGFsU2VydmljZS5tb2RhbExpc3QucHVzaChjb21wb25lbnQpO1xuXG5cdFx0cmV0dXJuIGNvbXBvbmVudDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuZCByZW5kZXJzIGEgbmV3IGFsZXJ0IG1vZGFsIGNvbXBvbmVudC5cblx0ICogQHBhcmFtIGRhdGEgWW91IGNhbiBwYXNzIGluOlxuXHQgKiBgdHlwZWAgLSBcImRlZmF1bHRcIiB8IFwiZGFuZ2VyXCIgPSBcImRlZmF1bHRcIixcblx0ICogYGxhYmVsYCAtIGEgbGFiZWwgc2hvd24gb3ZlciB0aGUgdGl0bGUsXG5cdCAqIGB0aXRsZWAgLSBtb2RhbCdzIHRpdGxlLFxuXHQgKiBgY29udGVudGAgLSBtb2RhbCdzIGNvbnRlbnQsIGNvdWxkIGluY2x1ZGUgSFRNTCB0YWdzLlxuXHQgKiBgYnV0dG9uc2AgaXMgYW4gYXJyYXkgb2Ygb2JqZWN0c1xuXHQgKiBgY2xvc2VgIGN1c3RvbSBjbG9zZSBmdW5jdGlvblxuXHQgKiBgYGBcblx0ICoge1xuXHQgKiBcdFx0dGV4dDogXCJCdXR0b24gdGV4dFwiLFxuXHQgKiBcdFx0dHlwZTogXCJwcmltYXJ5XCIgfCBcInNlY29uZGFyeVwiIHwgXCJ0ZXJ0aWFyeVwiIHwgXCJnaG9zdFwiIHwgXCJkYW5nZXJcIiB8IFwiZGFuZ2VyLS1wcmltYXJ5XCIgPSBcInByaW1hcnlcIixcblx0ICogXHRcdGNsaWNrOiBjbGlja0Z1bmN0aW9uLFxuXHQgKiB9XG5cdCAqIGBgYFxuXHQgKi9cblx0c2hvdyhkYXRhOiBBbGVydE1vZGFsRGF0YSkge1xuXHRcdHJldHVybiB0aGlzLmNyZWF0ZSh7XG5cdFx0XHRjb21wb25lbnQ6IEFsZXJ0TW9kYWwsXG5cdFx0XHRpbnB1dHM6IHtcblx0XHRcdFx0dHlwZTogZGF0YS50eXBlLFxuXHRcdFx0XHRsYWJlbDogZGF0YS5sYWJlbCxcblx0XHRcdFx0dGl0bGU6IGRhdGEudGl0bGUsXG5cdFx0XHRcdGNvbnRlbnQ6IGRhdGEuY29udGVudCxcblx0XHRcdFx0aGFzU2Nyb2xsaW5nQ29udGVudDogZGF0YS5oYXNTY3JvbGxpbmdDb250ZW50IHx8IG51bGwsXG5cdFx0XHRcdHNpemU6IGRhdGEuc2l6ZSxcblx0XHRcdFx0YnV0dG9uczogZGF0YS5idXR0b25zIHx8IFtdLFxuXHRcdFx0XHRjbG9zZTogZGF0YS5jbG9zZSB8fCAoKCkgPT4ge30pLFxuXHRcdFx0XHRzaG93Q2xvc2VCdXR0b246IGRhdGEuc2hvd0Nsb3NlQnV0dG9uXG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogRGVzdHJveXMgdGhlIG1vZGFsIG9uIHRoZSBzdXBwbGllZCBpbmRleC5cblx0ICogV2hlbiBjYWxsZWQgd2l0aG91dCBwYXJhbWV0ZXJzIGl0IGRlc3Ryb3lzIHRoZSBtb3N0IHJlY2VudGx5IGNyZWF0ZWQvdG9wIG1vc3QgbW9kYWwuXG5cdCAqL1xuXHRkZXN0cm95KGluZGV4ID0gLTEpIHtcblx0XHQvLyByZXR1cm4gaWYgbm90aGluZyB0byBkZXN0cm95IGJlY2F1c2UgaXQncyBhbHJlYWR5IGRlc3Ryb3llZFxuXHRcdGlmIChpbmRleCA+PSBNb2RhbFNlcnZpY2UubW9kYWxMaXN0Lmxlbmd0aCB8fCBNb2RhbFNlcnZpY2UubW9kYWxMaXN0Lmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHQvLyBvbiBuZWdhdGl2ZSBpbmRleCBkZXN0cm95IHRoZSBsYXN0IG9uIHRoZSBsaXN0ICh0b3AgbW9kYWwpXG5cdFx0aWYgKGluZGV4IDwgMCkge1xuXHRcdFx0aW5kZXggPSBNb2RhbFNlcnZpY2UubW9kYWxMaXN0Lmxlbmd0aCAtIDE7XG5cdFx0fVxuXG5cdFx0dGhpcy5wbGFjZWhvbGRlclNlcnZpY2UuZGVzdHJveUNvbXBvbmVudChNb2RhbFNlcnZpY2UubW9kYWxMaXN0W2luZGV4XSk7XG5cdFx0TW9kYWxTZXJ2aWNlLm1vZGFsTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXHR9XG59XG5cbiJdfQ==