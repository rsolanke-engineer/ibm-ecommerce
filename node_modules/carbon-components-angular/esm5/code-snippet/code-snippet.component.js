/**
 *
 * carbon-angular v0.0.0 | code-snippet.component.js
 *
 * Copyright 2014, 2022 IBM
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0

 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


import { Component, Input, HostBinding, ViewChild, HostListener } from "@angular/core";
import { I18n } from "carbon-components-angular/i18n";
export var SnippetType;
(function (SnippetType) {
    SnippetType["single"] = "single";
    SnippetType["multi"] = "multi";
    SnippetType["inline"] = "inline";
})(SnippetType || (SnippetType = {}));
/**
 * [See demo](../../?path=/story/components-code-snippet--basic)
 *
 * ```html
 * <ibm-code-snippet>Code</ibm-code-snippet>
 * ```
 *
 * <example-url>../../iframe.html?id=components-code-snippet--basic</example-url>
 */
var CodeSnippet = /** @class */ (function () {
    /**
     * Creates an instance of CodeSnippet.
     */
    function CodeSnippet(i18n) {
        this.i18n = i18n;
        /**
         * It can be `"single"`, `"multi"` or `"inline"`
         *
         */
        this.display = SnippetType.single;
        this.translations = this.i18n.get().CODE_SNIPPET;
        /**
         * Set to `"light"` to apply the light style on the code snippet.
         */
        this.theme = "dark";
        /**
         * Text displayed in the tooltip when user clicks button to copy code.
         *
         */
        this.feedbackText = this.translations.COPIED;
        /**
         * Time in miliseconds to keep the feedback tooltip displayed.
         *
         */
        this.feedbackTimeout = 2000;
        this.expanded = false;
        this.skeleton = false;
        this.snippetClass = true;
        this.showFeedback = false;
        this.hasExpandButton = null;
        CodeSnippet.codeSnippetCount++;
    }
    Object.defineProperty(CodeSnippet.prototype, "snippetSingleClass", {
        get: function () {
            return this.display === SnippetType.single;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "snippetMultiClass", {
        get: function () {
            return this.display === SnippetType.multi;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "snippetInlineClass", {
        get: function () {
            return this.display === SnippetType.inline;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "snippetInlineLightClass", {
        get: function () {
            return this.theme === "light";
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "btnCopyClass", {
        get: function () {
            return this.display === SnippetType.inline;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "displayStyle", {
        get: function () {
            return this.display !== SnippetType.inline ? "block" : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "attrType", {
        get: function () {
            return this.display === SnippetType.inline ? "button" : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CodeSnippet.prototype, "shouldShowExpandButton", {
        get: function () {
            // Checks if `hasExpand` button has been initialized in `AfterViewInit` before detecting whether or not to
            // show the expand button when the code displayed in the component changes during the life of the component.
            // This is to avoid the `ExpressionChangedAfterItHasBeenCheckedError`.
            if (this.hasExpandButton === null) {
                return this.hasExpandButton;
            }
            return this.canExpand();
        },
        enumerable: true,
        configurable: true
    });
    CodeSnippet.prototype.toggleSnippetExpansion = function () {
        this.expanded = !this.expanded;
    };
    /**
     * Copies the code from the `<code>` block to clipboard.
     *
     */
    CodeSnippet.prototype.copyCode = function () {
        // create invisible, uneditable textarea with our code in it
        var textarea = document.createElement("textarea");
        textarea.value = this.code.nativeElement.innerText || this.code.nativeElement.textContent;
        textarea.setAttribute("readonly", "");
        textarea.style.position = "absolute";
        textarea.style.right = "-99999px";
        document.body.appendChild(textarea);
        // save user selection
        var selected = document.getSelection().rangeCount ? document.getSelection().getRangeAt(0) : null;
        // copy to clipboard
        textarea.select();
        document.execCommand("copy");
        // remove textarea
        document.body.removeChild(textarea);
        // restore user selection
        if (selected) {
            document.getSelection().removeAllRanges();
            document.getSelection().addRange(selected);
        }
    };
    CodeSnippet.prototype.onCopyButtonClicked = function () {
        var _this = this;
        this.copyCode();
        this.showFeedback = true;
        setTimeout(function () {
            _this.showFeedback = false;
        }, this.feedbackTimeout);
    };
    CodeSnippet.prototype.ngAfterViewInit = function () {
        var _this = this;
        setTimeout(function () {
            if (_this.canExpand()) {
                _this.hasExpandButton = true;
            }
            else {
                _this.hasExpandButton = false;
            }
        });
    };
    /**
     * Inline code snippet acts as button and makes the whole component clickable.
     *
     * This handles clicks in that case.
     */
    CodeSnippet.prototype.hostClick = function () {
        if (this.display !== SnippetType.inline) {
            return;
        }
        this.onCopyButtonClicked();
    };
    CodeSnippet.prototype.canExpand = function () {
        return (this.code && this.code.nativeElement.getBoundingClientRect().height > 255) && this.display === "multi";
    };
    /**
     * Variable used for creating unique ids for code-snippet components.
     */
    CodeSnippet.codeSnippetCount = 0;
    CodeSnippet.decorators = [
        { type: Component, args: [{
                    selector: "ibm-code-snippet",
                    template: "\n\t\t<ng-container *ngIf=\"display === 'inline'; else notInline\">\n\t\t\t<ng-container *ngTemplateOutlet=\"codeTemplate\"></ng-container>\n\t\t\t<ng-container *ngTemplateOutlet=\"feedbackTemplate\"></ng-container>\n\t\t</ng-container>\n\n\t\t<ng-template #notInline>\n\t\t\t<div class=\"bx--snippet-container\" [attr.aria-label]=\"translations.CODE_SNIPPET_TEXT\">\n\t\t\t\t<ng-container *ngIf=\"skeleton\">\n\t\t\t\t\t<span *ngIf=\"display === 'single'; else multiSkeleton\"></span>\n\t\t\t\t\t<ng-template #multiSkeleton>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</ng-template>\n\t\t\t\t</ng-container>\n\t\t\t\t<pre *ngIf=\"!skeleton\"><ng-container *ngTemplateOutlet=\"codeTemplate\"></ng-container></pre>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\t*ngIf=\"!skeleton\"\n\t\t\t\tclass=\"bx--snippet-button\"\n\t\t\t\t[attr.aria-label]=\"translations.COPY_CODE\"\n\t\t\t\t(click)=\"onCopyButtonClicked()\"\n\t\t\t\ttabindex=\"0\">\n\t\t\t\t<svg ibmIcon=\"copy\" size=\"16\" class=\"bx--snippet__icon\"></svg>\n\t\t\t\t<ng-container *ngTemplateOutlet=\"feedbackTemplate\"></ng-container>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t*ngIf=\"shouldShowExpandButton\"\n\t\t\t\tclass=\"bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand\"\n\t\t\t\t(click)=\"toggleSnippetExpansion()\"\n\t\t\t\ttype=\"button\">\n\t\t\t\t<span class=\"bx--snippet-btn--text\">{{expanded ? translations.SHOW_LESS : translations.SHOW_MORE}}</span>\n\t\t\t\t<svg ibmIcon=\"chevron--down\" size=\"16\" class=\"bx--icon-chevron--down\" [ariaLabel]=\"translations.SHOW_MORE_ICON\"></svg>\n\t\t\t</button>\n\t\t</ng-template>\n\n\t\t<ng-template #codeTemplate>\n\t\t\t<code #code><ng-content></ng-content></code>\n\t\t</ng-template>\n\n\t\t<ng-template #feedbackTemplate>\n\t\t\t<div\n\t\t\tclass=\"bx--btn--copy__feedback\"\n\t\t\t[ngClass]=\"{\n\t\t\t\t'bx--btn--copy__feedback--displayed': showFeedback\n\t\t\t}\"\n\t\t\t[attr.data-feedback]=\"feedbackText\">\n\t\t\t</div>\n\t\t</ng-template>\n\t"
                }] }
    ];
    /** @nocollapse */
    CodeSnippet.ctorParameters = function () { return [
        { type: I18n }
    ]; };
    CodeSnippet.propDecorators = {
        display: [{ type: Input }],
        translations: [{ type: Input }],
        theme: [{ type: Input }],
        feedbackText: [{ type: Input }],
        feedbackTimeout: [{ type: Input }],
        expanded: [{ type: HostBinding, args: ["class.bx--snippet--expand",] }, { type: Input }],
        skeleton: [{ type: HostBinding, args: ["class.bx--skeleton",] }, { type: Input }],
        snippetClass: [{ type: HostBinding, args: ["class.bx--snippet",] }],
        snippetSingleClass: [{ type: HostBinding, args: ["class.bx--snippet--single",] }],
        snippetMultiClass: [{ type: HostBinding, args: ["class.bx--snippet--multi",] }],
        snippetInlineClass: [{ type: HostBinding, args: ["class.bx--snippet--inline",] }],
        snippetInlineLightClass: [{ type: HostBinding, args: ["class.bx--snippet--light",] }],
        btnCopyClass: [{ type: HostBinding, args: ["class.bx--btn--copy",] }],
        displayStyle: [{ type: HostBinding, args: ["style.display",] }],
        attrType: [{ type: HostBinding, args: ["attr.type",] }],
        code: [{ type: ViewChild, args: ["code", { static: false },] }],
        hostClick: [{ type: HostListener, args: ["click",] }]
    };
    return CodeSnippet;
}());
export { CodeSnippet };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZS1zbmlwcGV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2NhcmJvbi1jb21wb25lbnRzLWFuZ3VsYXIvY29kZS1zbmlwcGV0LyIsInNvdXJjZXMiOlsiY29kZS1zbmlwcGV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ04sU0FBUyxFQUNULEtBQUssRUFDTCxXQUFXLEVBQ1gsU0FBUyxFQUNULFlBQVksRUFFWixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFdEQsTUFBTSxDQUFOLElBQVksV0FJWDtBQUpELFdBQVksV0FBVztJQUN0QixnQ0FBaUIsQ0FBQTtJQUNqQiw4QkFBZSxDQUFBO0lBQ2YsZ0NBQWlCLENBQUE7QUFDbEIsQ0FBQyxFQUpXLFdBQVcsS0FBWCxXQUFXLFFBSXRCO0FBRUQ7Ozs7Ozs7O0dBUUc7QUFDSDtJQWdJQzs7T0FFRztJQUNILHFCQUFzQixJQUFVO1FBQVYsU0FBSSxHQUFKLElBQUksQ0FBTTtRQXZFaEM7OztXQUdHO1FBQ00sWUFBTyxHQUFnQixXQUFXLENBQUMsTUFBTSxDQUFDO1FBQzFDLGlCQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFFckQ7O1dBRUc7UUFDTSxVQUFLLEdBQXFCLE1BQU0sQ0FBQztRQUUxQzs7O1dBR0c7UUFDTSxpQkFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO1FBRWpEOzs7V0FHRztRQUNNLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBRW1CLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDeEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUUzQixpQkFBWSxHQUFHLElBQUksQ0FBQztRQXFDdEQsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFFckIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFNdEIsV0FBVyxDQUFDLGdC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QUs7K0JBQ0wsS0FBSzt3QkFLTCxLQUFLOytCQU1MLEtBQUs7a0NBTUwsS0FBSzsyQkFFTCxXQUFXLFNBQUMsMkJBQTJCLGNBQUcsS0FBSzsyQkFDL0MsV0FBVyxTQUFDLG9CQUFvQixjQUFHLEtBQUs7K0JBRXhDLFdBQVcsU0FBQyxtQkFBbUI7cUNBQy9CLFdBQVcsU0FBQywyQkFBMkI7b0NBR3ZDLFdBQVcsU0FBQywwQkFBMEI7cUNBR3RDLFdBQVcsU0FBQywyQkFBMkI7MENBR3ZDLFdBQVcsU0FBQywwQkFBMEI7K0JBR3RDLFdBQVcsU0FBQyxxQkFBcUI7K0JBSWpDLFdBQVcsU0FBQyxlQUFlOzJCQUczQixXQUFXLFNBQUMsV0FBVzt1QkFLdkIsU0FBUyxTQUFDLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7NEJBa0ZuQyxZQUFZLFNBQUMsT0FBTzs7SUFZdEIsa0JBQUM7Q0FBQSxBQTlNRCxJQThNQztTQXhKWSxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcblx0Q29tcG9uZW50LFxuXHRJbnB1dCxcblx0SG9zdEJpbmRpbmcsXG5cdFZpZXdDaGlsZCxcblx0SG9zdExpc3RlbmVyLFxuXHRBZnRlclZpZXdJbml0XG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IEkxOG4gfSBmcm9tIFwiY2FyYm9uLWNvbXBvbmVudHMtYW5ndWxhci9pMThuXCI7XG5cbmV4cG9ydCBlbnVtIFNuaXBwZXRUeXBlIHtcblx0c2luZ2xlID0gXCJzaW5nbGVcIixcblx0bXVsdGkgPSBcIm11bHRpXCIsXG5cdGlubGluZSA9IFwiaW5saW5lXCJcbn1cblxuLyoqXG4gKiBbU2VlIGRlbW9dKC4uLy4uLz9wYXRoPS9zdG9yeS9jb21wb25lbnRzLWNvZGUtc25pcHBldC0tYmFzaWMpXG4gKlxuICogYGBgaHRtbFxuICogPGlibS1jb2RlLXNuaXBwZXQ+Q29kZTwvaWJtLWNvZGUtc25pcHBldD5cbiAqIGBgYFxuICpcbiAqIDxleGFtcGxlLXVybD4uLi8uLi9pZnJhbWUuaHRtbD9pZD1jb21wb25lbnRzLWNvZGUtc25pcHBldC0tYmFzaWM8L2V4YW1wbGUtdXJsPlxuICovXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6IFwiaWJtLWNvZGUtc25pcHBldFwiLFxuXHR0ZW1wbGF0ZTogYFxuXHRcdDxuZy1jb250YWluZXIgKm5nSWY9XCJkaXNwbGF5ID09PSAnaW5saW5lJzsgZWxzZSBub3RJbmxpbmVcIj5cblx0XHRcdDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjb2RlVGVtcGxhdGVcIj48L25nLWNvbnRhaW5lcj5cblx0XHRcdDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJmZWVkYmFja1RlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+XG5cdFx0PC9uZy1jb250YWluZXI+XG5cblx0XHQ8bmctdGVtcGxhdGUgI25vdElubGluZT5cblx0XHRcdDxkaXYgY2xhc3M9XCJieC0tc25pcHBldC1jb250YWluZXJcIiBbYXR0ci5hcmlhLWxhYmVsXT1cInRyYW5zbGF0aW9ucy5DT0RFX1NOSVBQRVRfVEVYVFwiPlxuXHRcdFx0XHQ8bmctY29udGFpbmVyICpuZ0lmPVwic2tlbGV0b25cIj5cblx0XHRcdFx0XHQ8c3BhbiAqbmdJZj1cImRpc3BsYXkgPT09ICdzaW5nbGUnOyBlbHNlIG11bHRpU2tlbGV0b25cIj48L3NwYW4+XG5cdFx0XHRcdFx0PG5nLXRlbXBsYXRlICNtdWx0aVNrZWxldG9uPlxuXHRcdFx0XHRcdFx0PHNwYW4+PC9zcGFuPlxuXHRcdFx0XHRcdFx0PHNwYW4+PC9zcGFuPlxuXHRcdFx0XHRcdFx0PHNwYW4+PC9zcGFuPlxuXHRcdFx0XHRcdDwvbmctdGVtcGxhdGU+XG5cdFx0XHRcdDwvbmctY29udGFpbmVyPlxuXHRcdFx0XHQ8cHJlICpuZ0lmPVwiIXNrZWxldG9uXCI+PG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImNvZGVUZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPjwvcHJlPlxuXHRcdFx0PC9kaXY+XG5cdFx0XHQ8YnV0dG9uXG5cdFx0XHRcdCpuZ0lmPVwiIXNrZWxldG9uXCJcblx0XHRcdFx0Y2xhc3M9XCJieC0tc25pcHBldC1idXR0b25cIlxuXHRcdFx0XHRbYXR0ci5hcmlhLWxhYmVsXT1cInRyYW5zbGF0aW9ucy5DT1BZX0NPREVcIlxuXHRcdFx0XHQoY2xpY2spPVwib25Db3B5QnV0dG9uQ2xpY2tlZCgpXCJcblx0XHRcdFx0dGFiaW5kZXg9XCIwXCI+XG5cdFx0XHRcdDxzdmcgaWJtSWNvbj1cImNvcHlcIiBzaXplPVwiMTZcIiBjbGFzcz1cImJ4LS1zbmlwcGV0X19pY29uXCI+PC9zdmc+XG5cdFx0XHRcdDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJmZWVkYmFja1RlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+XG5cdFx0XHQ8L2J1dHRvbj5cblx0XHRcdDxidXR0b25cblx0XHRcdFx0Km5nSWY9XCJzaG91bGRTaG93RXhwYW5kQnV0dG9uXCJcblx0XHRcdFx0Y2xhc3M9XCJieC0tYnRuIGJ4LS1idG4tLWdob3N0IGJ4LS1idG4tLXNtIGJ4LS1zbmlwcGV0LWJ0bi0tZXhwYW5kXCJcblx0XHRcdFx0KGNsaWNrKT1cInRvZ2dsZVNuaXBwZXRFeHBhbnNpb24oKVwiXG5cdFx0XHRcdHR5cGU9XCJidXR0b25cIj5cblx0XHRcdFx0PHNwYW4gY2xhc3M9XCJieC0tc25pcHBldC1idG4tLXRleHRcIj57e2V4cGFuZGVkID8gdHJhbnNsYXRpb25zLlNIT1dfTEVTUyA6IHRyYW5zbGF0aW9ucy5TSE9XX01PUkV9fTwvc3Bhbj5cblx0XHRcdFx0PHN2ZyBpYm1JY29uPVwiY2hldnJvbi0tZG93blwiIHNpemU9XCIxNlwiIGNsYXNzPVwiYngtLWljb24tY2hldnJvbi0tZG93blwiIFthcmlhTGFiZWxdPVwidHJhbnNsYXRpb25zLlNIT1dfTU9SRV9JQ09OXCI+PC9zdmc+XG5cdFx0XHQ8L2J1dHRvbj5cblx0XHQ8L25nLXRlbXBsYXRlPlxuXG5cdFx0PG5nLXRlbXBsYXRlICNjb2RlVGVtcGxhdGU+XG5cdFx0XHQ8Y29kZSAjY29kZT48bmctY29udGVudD48L25nLWNvbnRlbnQ+PC9jb2RlPlxuXHRcdDwvbmctdGVtcGxhdGU+XG5cblx0XHQ8bmctdGVtcGxhdGUgI2ZlZWRiYWNrVGVtcGxhdGU+XG5cdFx0XHQ8ZGl2XG5cdFx0XHRjbGFzcz1cImJ4LS1idG4tLWNvcHlfX2ZlZWRiYWNrXCJcblx0XHRcdFtuZ0NsYXNzXT1cIntcblx0XHRcdFx0J2J4LS1idG4tLWNvcHlfX2ZlZWRiYWNrLS1kaXNwbGF5ZWQnOiBzaG93RmVlZGJhY2tcblx0XHRcdH1cIlxuXHRcdFx0W2F0dHIuZGF0YS1mZWVkYmFja109XCJmZWVkYmFja1RleHRcIj5cblx0XHRcdDwvZGl2PlxuXHRcdDwvbmctdGVtcGxhdGU+XG5cdGBcbn0pXG5leHBvcnQgY2xhc3MgQ29kZVNuaXBwZXQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcblx0LyoqXG5cdCAqIFZhcmlhYmxlIHVzZWQgZm9yIGNyZWF0aW5nIHVuaXF1ZSBpZHMgZm9yIGNvZGUtc25pcHBldCBjb21wb25lbnRzLlxuXHQgKi9cblx0c3RhdGljIGNvZGVTbmlwcGV0Q291bnQgPSAwO1xuXG5cdC8qKlxuXHQgKiBJdCBjYW4gYmUgYFwic2luZ2xlXCJgLCBgXCJtdWx0aVwiYCBvciBgXCJpbmxpbmVcImBcblx0ICpcblx0ICovXG5cdEBJbnB1dCgpIGRpc3BsYXk6IFNuaXBwZXRUeXBlID0gU25pcHBldFR5cGUuc2luZ2xlO1xuXHRASW5wdXQoKSB0cmFuc2xhdGlvbnMgPSB0aGlzLmkxOG4uZ2V0KCkuQ09ERV9TTklQUEVUO1xuXG5cdC8qKlxuXHQgKiBTZXQgdG8gYFwibGlnaHRcImAgdG8gYXBwbHkgdGhlIGxpZ2h0IHN0eWxlIG9uIHRoZSBjb2RlIHNuaXBwZXQuXG5cdCAqL1xuXHRASW5wdXQoKSB0aGVtZTogXCJsaWdodFwiIHwgXCJkYXJrXCIgPSBcImRhcmtcIjtcblxuXHQvKipcblx0ICogVGV4dCBkaXNwbGF5ZWQgaW4gdGhlIHRvb2x0aXAgd2hlbiB1c2VyIGNsaWNrcyBidXR0b24gdG8gY29weSBjb2RlLlxuXHQgKlxuXHQgKi9cblx0QElucHV0KCkgZmVlZGJhY2tUZXh0ID0gdGhpcy50cmFuc2xhdGlvbnMuQ09QSUVEO1xuXG5cdC8qKlxuXHQgKiBUaW1lIGluIG1pbGlzZWNvbmRzIHRvIGtlZXAgdGhlIGZlZWRiYWNrIHRvb2x0aXAgZGlzcGxheWVkLlxuXHQgKlxuXHQgKi9cblx0QElucHV0KCkgZmVlZGJhY2tUaW1lb3V0ID0gMjAwMDtcblxuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc25pcHBldC0tZXhwYW5kXCIpIEBJbnB1dCgpIGV4cGFuZGVkID0gZmFsc2U7XG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1za2VsZXRvblwiKSBASW5wdXQoKSBza2VsZXRvbiA9IGZhbHNlO1xuXG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1zbmlwcGV0XCIpIHNuaXBwZXRDbGFzcyA9IHRydWU7XG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1zbmlwcGV0LS1zaW5nbGVcIikgZ2V0IHNuaXBwZXRTaW5nbGVDbGFzcygpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ID09PSBTbmlwcGV0VHlwZS5zaW5nbGU7XG5cdH1cblx0QEhvc3RCaW5kaW5nKFwiY2xhc3MuYngtLXNuaXBwZXQtLW11bHRpXCIpIGdldCBzbmlwcGV0TXVsdGlDbGFzcygpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ID09PSBTbmlwcGV0VHlwZS5tdWx0aTtcblx0fVxuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tc25pcHBldC0taW5saW5lXCIpIGdldCBzbmlwcGV0SW5saW5lQ2xhc3MoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheSA9PT0gU25pcHBldFR5cGUuaW5saW5lO1xuXHR9XG5cdEBIb3N0QmluZGluZyhcImNsYXNzLmJ4LS1zbmlwcGV0LS1saWdodFwiKSBnZXQgc25pcHBldElubGluZUxpZ2h0Q2xhc3MoKSB7XG5cdFx0cmV0dXJuIHRoaXMudGhlbWUgPT09IFwibGlnaHRcIjtcblx0fVxuXHRASG9zdEJpbmRpbmcoXCJjbGFzcy5ieC0tYnRuLS1jb3B5XCIpIGdldCBidG5Db3B5Q2xhc3MoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZGlzcGxheSA9PT0gU25pcHBldFR5cGUuaW5saW5lO1xuXHR9XG5cblx0QEhvc3RCaW5kaW5nKFwic3R5bGUuZGlzcGxheVwiKSBnZXQgZGlzcGxheVN0eWxlKCkge1xuXHRcdHJldHVybiB0aGlzLmRpc3BsYXkgIT09IFNuaXBwZXRUeXBlLmlubGluZSA/IFwiYmxvY2tcIiA6IG51bGw7XG5cdH1cblx0QEhvc3RCaW5kaW5nKFwiYXR0ci50eXBlXCIpIGdldCBhdHRyVHlwZSgpIHtcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5ID09PSBTbmlwcGV0VHlwZS5pbmxpbmUgPyBcImJ1dHRvblwiIDogbnVsbDtcblx0fVxuXG5cdC8vIEB0cy1pZ25vcmVcblx0QFZpZXdDaGlsZChcImNvZGVcIiwgeyBzdGF0aWM6IGZhbHNlIH0pIGNvZGU7XG5cblx0Z2V0IHNob3VsZFNob3dFeHBhbmRCdXR0b24oKSB7XG5cdFx0Ly8gQ2hlY2tzIGlmIGBoYXNFeHBhbmRgIGJ1dHRvbiBoYXMgYmVlbiBpbml0aWFsaXplZCBpbiBgQWZ0ZXJWaWV3SW5pdGAgYmVmb3JlIGRldGVjdGluZyB3aGV0aGVyIG9yIG5vdCB0b1xuXHRcdC8vIHNob3cgdGhlIGV4cGFuZCBidXR0b24gd2hlbiB0aGUgY29kZSBkaXNwbGF5ZWQgaW4gdGhlIGNvbXBvbmVudCBjaGFuZ2VzIGR1cmluZyB0aGUgbGlmZSBvZiB0aGUgY29tcG9uZW50LlxuXHRcdC8vIFRoaXMgaXMgdG8gYXZvaWQgdGhlIGBFeHByZXNzaW9uQ2hhbmdlZEFmdGVySXRIYXNCZWVuQ2hlY2tlZEVycm9yYC5cblx0XHRpZiAodGhpcy5oYXNFeHBhbmRCdXR0b24gPT09IG51bGwpIHtcblx0XHRcdHJldHVybiB0aGlzLmhhc0V4cGFuZEJ1dHRvbjtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMuY2FuRXhwYW5kKCk7XG5cdH1cblxuXHRzaG93RmVlZGJhY2sgPSBmYWxzZTtcblxuXHRoYXNFeHBhbmRCdXR0b24gPSBudWxsO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIENvZGVTbmlwcGV0LlxuXHQgKi9cblx0Y29uc3RydWN0b3IocHJvdGVjdGVkIGkxOG46IEkxOG4pIHtcblx0XHRDb2RlU25pcHBldC5jb2RlU25pcHBldENvdW50Kys7XG5cdH1cblxuXHR0b2dnbGVTbmlwcGV0RXhwYW5zaW9uKCkge1xuXHRcdHRoaXMuZXhwYW5kZWQgPSAhdGhpcy5leHBhbmRlZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDb3BpZXMgdGhlIGNvZGUgZnJvbSB0aGUgYDxjb2RlPmAgYmxvY2sgdG8gY2xpcGJvYXJkLlxuXHQgKlxuXHQgKi9cblx0Y29weUNvZGUoKSB7XG5cdFx0Ly8gY3JlYXRlIGludmlzaWJsZSwgdW5lZGl0YWJsZSB0ZXh0YXJlYSB3aXRoIG91ciBjb2RlIGluIGl0XG5cdFx0Y29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGV4dGFyZWFcIik7XG5cdFx0dGV4dGFyZWEudmFsdWUgPSB0aGlzLmNvZGUubmF0aXZlRWxlbWVudC5pbm5lclRleHQgfHwgdGhpcy5jb2RlLm5hdGl2ZUVsZW1lbnQudGV4dENvbnRlbnQ7XG5cdFx0dGV4dGFyZWEuc2V0QXR0cmlidXRlKFwicmVhZG9ubHlcIiwgXCJcIik7XG5cdFx0dGV4dGFyZWEuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG5cdFx0dGV4dGFyZWEuc3R5bGUucmlnaHQgPSBcIi05OTk5OXB4XCI7XG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7XG5cblx0XHQvLyBzYXZlIHVzZXIgc2VsZWN0aW9uXG5cdFx0Y29uc3Qgc2VsZWN0ZWQgPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5yYW5nZUNvdW50ID8gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKSA6IG51bGw7XG5cblx0XHQvLyBjb3B5IHRvIGNsaXBib2FyZFxuXHRcdHRleHRhcmVhLnNlbGVjdCgpO1xuXHRcdGRvY3VtZW50LmV4ZWNDb21tYW5kKFwiY29weVwiKTtcblxuXHRcdC8vIHJlbW92ZSB0ZXh0YXJlYVxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGV4dGFyZWEpO1xuXG5cdFx0Ly8gcmVzdG9yZSB1c2VyIHNlbGVjdGlvblxuXHRcdGlmIChzZWxlY3RlZCkge1xuXHRcdFx0ZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XG5cdFx0XHRkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5hZGRSYW5nZShzZWxlY3RlZCk7XG5cdFx0fVxuXHR9XG5cblx0b25Db3B5QnV0dG9uQ2xpY2tlZCgpIHtcblx0XHR0aGlzLmNvcHlDb2RlKCk7XG5cblx0XHR0aGlzLnNob3dGZWVkYmFjayA9IHRydWU7XG5cblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdHRoaXMuc2hvd0ZlZWRiYWNrID0gZmFsc2U7XG5cdFx0fSwgdGhpcy5mZWVkYmFja1RpbWVvdXQpO1xuXHR9XG5cblx0bmdBZnRlclZpZXdJbml0KCkge1xuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0aWYgKHRoaXMuY2FuRXhwYW5kKCkpIHtcblx0XHRcdFx0dGhpcy5oYXNFeHBhbmRCdXR0b24gPSB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5oYXNFeHBhbmRCdXR0b24gPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBJbmxpbmUgY29kZSBzbmlwcGV0IGFjdHMgYXMgYnV0dG9uIGFuZCBtYWtlcyB0aGUgd2hvbGUgY29tcG9uZW50IGNsaWNrYWJsZS5cblx0ICpcblx0ICogVGhpcyBoYW5kbGVzIGNsaWNrcyBpbiB0aGF0IGNhc2UuXG5cdCAqL1xuXHRASG9zdExpc3RlbmVyKFwiY2xpY2tcIilcblx0aG9zdENsaWNrKCkge1xuXHRcdGlmICh0aGlzLmRpc3BsYXkgIT09IFNuaXBwZXRUeXBlLmlubGluZSkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHRoaXMub25Db3B5QnV0dG9uQ2xpY2tlZCgpO1xuXHR9XG5cblx0cHJvdGVjdGVkIGNhbkV4cGFuZCgpIHtcblx0XHRyZXR1cm4gKHRoaXMuY29kZSAmJiB0aGlzLmNvZGUubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgPiAyNTUpICYmIHRoaXMuZGlzcGxheSA9PT0gXCJtdWx0aVwiO1xuXHR9XG59XG4iXX0=